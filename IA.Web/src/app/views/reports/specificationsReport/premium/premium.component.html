<div class="width-100">
  <mat-card>
    <mat-card-content>
      <mat-card-title>{{'PREMIUM' | translate}}
          <button [disabled]="totalPremiums == 0" id="filter1-button" class="primary filter-button-mobile" type="button" mat-raised-button color="primary"
          (click)="generateExcel()"><i class="ti-download"></i>
            {{'EXPORT_TO_EXCEL' | translate}}</button>
      </mat-card-title>
    <br>
      <div class=row>
        <div class="col-md">
          <form>
            <mat-form-field class="form-field-width width-90-percents">
              <input matInput [matDatepicker]="dp" disabled #DateFrom="ngModel"
                placeholder="{{'DATE_FROM' | translate}}" name="dateFrom" id="dateFrom"
                [(ngModel)]="filter.DateFrom" (dateChange)="chosenFromMonthHandler(dp)">
              <mat-datepicker-toggle  matSuffix [for]="dp"></mat-datepicker-toggle>
              <mat-datepicker  id="dp" #dp disabled="false">
              </mat-datepicker>
            </mat-form-field>
            <div class="icon-position"><a (click)="clear('DateFrom')" class="cursor-pointer"><i
              class="icon line-height-25">clear</i></a> </div>
          </form>
        </div>
        <div class="col-md">
          <form>
            <mat-form-field class="form-field-width width-90-percents">
              <input matInput [matDatepicker]="dpo" disabled #DateTo="ngModel"
                placeholder="{{'DATE_TO' | translate}}" name="dateTo" id="dateTo" [(ngModel)]="filter.DateTo"  (dateChange)="chosenToMonthHandler(dpo)">
              <mat-datepicker-toggle  matSuffix [for]="dpo"></mat-datepicker-toggle>
              <mat-datepicker  #dpo disabled="false">
              </mat-datepicker>
            </mat-form-field>
            <div class="icon-position"><a (click)="clear('DateTo')" class="cursor-pointer"><i
              class="icon line-height-25">clear</i></a> </div>
          </form>
        </div>
        <div class="col-md">
          <arni-autocomplete #mainOfficeComponent displayField="Name" [items]="mainOffices" [selectedItem]="selectedMainOffice"
            (onChange)="onSelectedMainOfficeChange($event)" placeholder="{{'MAIN_OFFICE' | translate}}" (click)="getMainOffices()"
            (keydown.enter)="refreshPremiums()">
          </arni-autocomplete>
        </div>
        <div class="col-md">
          <arni-autocomplete #insuranceComponent displayField="Name" [items]="insurances" [selectedItem]="selectedInsurance"
            (onChange)="onSelectedInsuranceChange($event)" placeholder="{{'INSURANCE_COMPANY' | translate}}" (click)="getInsurances()"
            (keydown.enter)="refreshPremiums()">
          </arni-autocomplete>
        </div>
      </div>
      <div class="row">
        <div class="col-md">
          <arni-autocomplete #insuranceTypeComponent displayField="LabelName" [items]="insuranceTypes" [selectedItem]="selectedInsuranceType"
            (onChange)="onSelectedInsuranceType($event)" placeholder="{{'INSURANCE_TYPE' | translate}}" (click)="getInsuranceTypes()"
            (keydown.enter)="refreshPremiums()">
          </arni-autocomplete>
        </div>
        <div class="col-md">
          <mat-form-field id="search-input" class="example-full-width">
            <input matInput class="input" type="text" #searchText="ngModel" [(ngModel)]="SearchText" name="PolicyNumber"
              placeholder="{{'POLICY_NUMBER_SEARCH' | translate}}" (keydown.enter)="refreshPremiums()" />
          </mat-form-field>
        </div>
        <div class="col-md">
          <arni-autocomplete #policyHoldersComponent displayField="DisplayName" name="policyHolder" (click)="getPolicyHolders()"
          (onChange)="onSelectedPolicyHolderChange($event)" [items]="policyHolders" [selectedItem]="selectedPolicyHolder"
          (keydown.enter)="refreshPremiums()" placeholder="{{'POLICY_HOLDER_SEARCH' | translate}}">
        </arni-autocomplete>
        </div>
        <div class="col-md">
          <button id="filter1-button" class="primary-button filter-button-mobile" type="button" mat-raised-button color="primary"
          (click)="refreshPremiums()"><i class="material-icons search">search</i>
            {{'FILTER' | translate}}</button>
        </div>
      </div>
      <p-table #dt [value]="premiums" sortField="MainOfficeName" [responsive]="true" [paginator]="true" [rows]="10" sortOrder="-1"
        [rowsPerPageOptions]="[10,20,30,40]" (onLazyLoad)="loadPremiums($event)" [totalRecords]="totalPremiums" [lazy]="true" dataKey="PolicyId" (onRowExpand)="rowExpand($event)" rowExpandMode="single">
        <ng-template pTemplate="header">
          <tr>
            <th class="text-right" style="width: 40px;">
              {{'RB' | translate}}
            </th>
            <th [pSortableColumn]="'MainOfficeName'" class="text-right width-120-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'MAIN_OFFICE' | translate}}
            </th>
            <th [pSortableColumn]="'InsuranceName'" class="text-right width-150-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'INSURANCE_COMPANY' | translate}}
            </th>
            <th [pSortableColumn]="'PolicyExpiration'" class="text-right width-120-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'DATE_OF_EXPIRATION' | translate}}
            </th>
            <th [pSortableColumn]="'InsuranceType'" class="text-right width-60-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'INSURANCE_TYPE_SHORT' | translate}}
            </th>
            <th [pSortableColumn]="'Created'" class="text-right width-150-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'ISSUE_DATE' | translate}}
            </th>
            <th [pSortableColumn]="'Number'" class="text-right width-120-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'POLICY_NUMBER' | translate}}
            </th>
            <th [pSortableColumn]="'PolicyHolderFullName'" class="text-right width-150-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'POLICY_HOLDER_NAME' | translate}}
            </th>
            <th [pSortableColumn]="'Price'" class="text-right width-80-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'POLICY_PRICE' | translate}}
            </th>
            <th [pSortableColumn]="'CarAccidentCompensation'" class="text-right width-80-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'CAR_ACCIDENT' | translate}}
            </th>
            <th [pSortableColumn]="'Total'" class="text-right width-80-px">
              <i class="ui-sortable-column-icon pi pi-fw pi-sort"></i>
              {{'TOTAL_PREMIUM' | translate}}
            </th>
            <th class="w-40">
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-premium let-expanded="expanded" let-i="rowIndex" let-columns="columns">
          <tr>
            <td class="text-right"><span
              class="ui-column-title text-left float-left">{{ 'RB' | translate }}</span>
              {{i+1}}
            </td>
            <td class="text-right"><span
                class="ui-column-title text-left float-left">{{ 'MAIN_OFFICE' | translate }}</span><span
                class="float-right">{{premium.MainOfficeName || '-'}}</span></td>
            <td class="text-right"><span
                class="ui-column-title text-left float-left">{{ 'INSURANCE_NAME' | translate }}</span><span
                class="float-right">{{premium.InsuranceName}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'DATE_OF_EXPIRATION' | translate }}</span><span
                class="float-right">{{premium.PolicyExpiration | dateFormat}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'INSURANCE_TYPE' | translate }}</span><span
                class="float-right">{{premium.InsuranceType}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'CREATED_DATE' | translate }}</span><span
                class="float-right">{{premium.Created | dateTimeFormat}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'POLICY_NUMBER' | translate }}</span><span
                class="float-right">{{premium.Number}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'POLICY_HOLDER_INFO' | translate }}</span><span
                class="float-right">{{premium.PolicyHolderFullName == null? premium.CompanyName : premium.PolicyHolderFullName}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'POLICY_PRICE' | translate }}</span><span
                class="float-right">{{premium.Price}} KM</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'CAR_ACCIDENT_COMPENSATION' | translate }}</span><span
                class="float-right">{{premium.CarAccidentCompensation}} KM</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'TOTAL' | translate }}</span><span
                class="float-right">{{premium.Total}} KM</span></td>
                <td>
                  <a  class="theme-color" href="#" [pRowToggler]="premium">
                    <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
                  </a>
                </td>
          </tr>
        </ng-template>
          <ng-template pTemplate="rowexpansion" let-columns="columns">
            <mat-card class="width-1515">
              <mat-card-content>
                <mat-card-title class="m-b-15">{{"PREMIUM_DETAILS" | translate}}</mat-card-title>
                  <table class="example-full-width"><tr>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #Netto="ngModel"
                      [(ngModel)]="premiumsExpanded.Netto" name="Netto" placeholder="{{'NETTO' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #CommissionIncome="ngModel"
                      [(ngModel)]="premiumsExpanded.CommissionIncome" name="CommissionIncome" placeholder="{{'COMMISSION_INCOME' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #PolicyHolder="ngModel"
                      [(ngModel)]="premiumsExpanded.PolicyHolder" name="PolicyHolder" placeholder="{{'POLICY_HOLDER' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #TechnicalInspection="ngModel"
                      [(ngModel)]="premiumsExpanded.TechnicalInspection" name="TechnicalInspection" placeholder="{{'TECHNICAL_INSPECTION' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #TechnicalInspection="ngModel"
                      [(ngModel)]="premiumsExpanded.Number" name="TechnicalInspection" placeholder="{{'POLICY_NUMBER' | translate}}">
                    </mat-form-field></td>
                  </tr>
                  <tr>
                 <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #Price="ngModel"
                      [(ngModel)]="premiumsExpanded.Price" name="Price" placeholder="{{'POLICY_PRICE' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #PersonalIdentificationNumber="ngModel"
                      [(ngModel)]="premiumsExpanded.PersonalIdentificationNumber" name="PersonalIdentificationNumber" placeholder="{{'PERSONAL_IDENTIFICATION_NUMBER' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #Address="ngModel"
                      [(ngModel)]="premiumsExpanded.Address" name="Address" placeholder="{{'ADDRESS' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #CityName="ngModel"
                      [(ngModel)]="premiumsExpanded.CityName" name="CityName" placeholder="{{'CITY_NAME' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                      <mat-select  [disabled]="true" placeholder="{{'STATUS' | translate}}" name="Status" id="Status" #Status="ngModel"
                      [(ngModel)]="premiumsExpanded.VehicleType">
                      <mat-option [value]="-1">
                        {{'ALL' | translate}}
                      </mat-option>
                      <mat-option *ngFor="let type of vehicleType" [value]="type.value">
                        {{type.name | uppercase | translate}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field></td>
                </tr>
                <tr>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #CarBrand="ngModel"
                      [(ngModel)]="premiumsExpanded.CarBrand" name="CarBrand" placeholder="{{'CAR_BRAND' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #CarModel="ngModel"
                      [(ngModel)]="premiumsExpanded.CarModel" name="CarModel" placeholder="{{'CAR_MODEL' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #LicensePlate="ngModel"
                      [(ngModel)]="premiumsExpanded.LicensePlate" name="LicensePlate" placeholder="{{'LICENSE_PLATE' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #ProductionYear="ngModel"
                      [(ngModel)]="premiumsExpanded.ProductionYear" name="ProductionYear" placeholder="{{'PRODUCTION_YEAR' | translate}}">
                  </mat-form-field></td>
                  <td class="width-295"><mat-form-field class="example-full-width td">
                    <input [disabled]="true" matInput required type="text" #EnginePower="ngModel"
                      [(ngModel)]="premiumsExpanded.EnginePower" name="EnginePower" placeholder="{{'ENGINE_POWER' | translate}}">
                  </mat-form-field></td>
                  </tr>
                  <tr>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #EngineDisplacement="ngModel"
                        [(ngModel)]="premiumsExpanded.EngineDisplacement" name="EngineDisplacement" placeholder="{{'ENGINE_DISPLACEMENT' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #LoadCapacity="ngModel"
                        [(ngModel)]="premiumsExpanded.LoadCapacity" name="LoadCapacity" placeholder="{{'LOAD_CAPACITY' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #MaxPermissibleMass="ngModel"
                        [(ngModel)]="premiumsExpanded.MaxPermissibleMass" name="MaxPermissibleMass" placeholder="{{'MAXIMUM_PERMISSIBLE_MASS' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #SeatsNumber="ngModel"
                        [(ngModel)]="premiumsExpanded.SeatsNumber" name="SeatsNumber" placeholder="{{'NUMBER_OF_SEATS' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #Color="ngModel"
                        [(ngModel)]="premiumsExpanded.Color" name="Color" placeholder="{{'COLOR' | translate}}">
                    </mat-form-field></td>
                  </tr>
                  <tr>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #ChassisNumber="ngModel"
                        [(ngModel)]="premiumsExpanded.ChassisNumber" name="ChassisNumber" placeholder="{{'CHASSIS_NUMBER' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #EngineNumber="ngModel"
                        [(ngModel)]="premiumsExpanded.EngineNumber" name="EngineNumber" placeholder="{{'ENGINE_NUMBER' | translate}}">
                    </mat-form-field></td>
                    <td class="width-295"><mat-form-field class="example-full-width td">
                      <input [disabled]="true" matInput required type="text" #MunicipalityCode="ngModel"
                        [(ngModel)]="premiumsExpanded.MunicipalityCode" name="MunicipalityCode" placeholder="{{'MUNICIPALITY_CODE' | translate}}">
                    </mat-form-field></td>
                  </tr>
                </table>
              </mat-card-content>
            </mat-card>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
              <td [attr.colspan]="12" class="text-center">
                  <strong>{{'NO_DATA' | translate}}</strong>
              </td>
          </tr>
        </ng-template>
      </p-table>
    </mat-card-content>
  </mat-card>
</div>
