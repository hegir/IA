<div class="width-100">
  <mat-card>
    <mat-card-content>
      <mat-card-title class="m-b-20">{{'PREMIUM_ANALYSIS_REPORT' | translate}}
      </mat-card-title>
      <div class="row">
        <div class="col-md-12">
          <button [disabled]="totalPremiumAnalysis == 0" type="button" mat-raised-button color="primary" class="primary filter-button-mobile"
          (click)="getAllPremiumAnalysis()"><i class="ti-download"></i>{{'EXPORT_TO_EXCEL' | translate}}</button>
        </div>
      </div>
      <div class="row">
        <div class="col-md-2" style="max-width: 23% !important;">
          <form #skadencaForm="ngForm">
            <mat-form-field class="form-field-width width-90-percents">
              <input matInput [matDatepicker]="dp" #DateFrom="ngModel" placeholder="{{'MONTH_AND_YEAR_FROM' | translate}}"
                name="dateFrom" id="dateFrom" [(ngModel)]="dateFrom" >
              <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
              <mat-datepicker id="dp" #dp startView="year" (monthSelected)="chosenFromMonthHandler($event, dp)">
              </mat-datepicker>
            </mat-form-field>
            <div class="icon-position"><a (click)="clear('dateFrom')" class="cursor-pointer float-left"><i
                  class="icon line-height-25">clear</i></a> </div>
          </form>
        </div>
        <div class="col-md-2" style="max-width: 23% !important;">
          <form #skadencaForm="ngForm">
            <mat-form-field class="form-field-width width-90-percents">
              <input matInput [matDatepicker]="dpo" #DateTo="ngModel" placeholder="{{'MONTH_AND_YEAR_TO' | translate}}"
                name="dateTo" id="dateTo" [(ngModel)]="dateTo">
              <mat-datepicker-toggle matSuffix [for]="dpo"></mat-datepicker-toggle>
              <mat-datepicker id="dpo" #dpo startView="year" (monthSelected)="chosenToMonthHandler($event, dpo)">
              </mat-datepicker>
            </mat-form-field>
            <div class="icon-position"><a (click)="clear('dateTo')" class="cursor-pointer float-left"><i
                  class="icon line-height-25">clear</i></a> </div>
          </form>
        </div>
        <div class="col-md-2" style="max-width: 23% !important;">
          <arni-autocomplete #usersComponent displayField="FullName" [items]="agents" [selectedItem]="selectedAgent"
            (onChange)="onSelectedAgentChange($event)" placeholder="{{'AGENT' | translate}}" (click)="getAgents()"
            (keydown.enter)="refreshAnalysisPremiums()">
          </arni-autocomplete>
        </div>
          <div class="col-md-2">
            <arni-autocomplete #mainOfficeComponent displayField="Name" [items]="mainOffices" [selectedItem]="selectedMainOffice"
              (onChange)="onSelectedMainOfficeChange($event)" placeholder="{{'MAIN_OFFICE' | translate}}" (click)="getMainOffices()"
              (keydown.enter)="refreshAnalysisPremiums()">
            </arni-autocomplete>
          </div>
          <div class="col-md-2" style="max-width: 13% !important;">
            <arni-autocomplete #insuranceTypeComponent displayField="Label" [items]="insuranceTypes"
              (keyup.enter)="refreshAnalysisPremiums()" [selectedItem]="selectedInsuranceType"
              (onChange)="onSelectedInsuranceType($event)" placeholder="{{'INSURANCE_TYPE_SHORT' | translate}}"
              (click)="getInsuranceTypes()">
            </arni-autocomplete>
          </div>
          <div class="col-md">
            <button id="filter1-button" class="primary-button filter-button-mobile" type="button" mat-raised-button color="primary"
            (click)="refreshAnalysisPremiums()"><i class="material-icons search">search</i>
            {{'FILTER' | translate}}</button>
          </div>
        </div>
      <p-table #dt [value]="premiumAnalysis" [responsive]="true" [paginator]="true" sortOrder="-1"
        sortField="MainOfficeName" [totalRecords]="totalPremiumAnalysis" (onLazyLoad)="loadPremiumAnalysis($event)"
        [rowsPerPageOptions]="[10,20,30,40,50]" [rows]="10" [lazy]="true">
        <ng-template pTemplate="header">
          <tr>
            <th class="text-right" style="width: 40px">
              {{'RB'| translate}}
            </th>
            <th class="text-right" [pSortableColumn]="'AgentName'">
              <p-sortIcon [field]="'InsuranceName'"></p-sortIcon>
              {{'AGENT' | translate}}
            </th>
            <th class="text-right" [pSortableColumn]="'MainOfficeName'">
              <p-sortIcon [field]="'MainOfficeName'"></p-sortIcon>
              {{'MAIN_OFFICE_NAME' | translate}}
            </th>
            <th class="text-right" [pSortableColumn]="'InsuranceTypeLabel'">
              <p-sortIcon [field]="'InsuranceTypeLabel'"></p-sortIcon>
              {{'INSURANCE_TYPE_SHORT' | translate}}
            </th>
            <th class="text-right" [pSortableColumn]="'Created'">
              <p-sortIcon [field]="'InsuranceTypeLabel'"></p-sortIcon>
              {{'MADE_DATE' | translate}}
            </th>
            <th class="text-right" [pSortableColumn]="'TotalPremium'">
              <p-sortIcon [field]="'InsuranceTypeLabel'"></p-sortIcon>
              {{'TOTAL_PREMIUM' | translate}}
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-analysis let-i="rowIndex">
          <tr>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'RB' | translate }}</span>
              {{i+1}}
            </td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'AGENT' | translate }}</span><span
                class="float-right">{{analysis.AgentName}}</span></td>
            <td class="text-right"><span
                class="ui-column-title text-left float-left">{{ 'MAIN_OFFICE_NAME' | translate}}</span><span
                class="float-right">{{analysis.MainOfficeName}}</span></td>
            <td class="text-right"><span
                class="ui-column-title text-left float-left">{{ 'INSURANCE_TYPE_SHORT' | translate }}</span><span
                class="float-right">{{analysis.InsuranceTypeLabel}}</span></td>
            <td class="text-right"><span class="ui-column-title text-left float-left">{{ 'MADE_DATE' | translate }}</span><span
                class="float-right">{{analysis.Created | dateFormat}}</span></td>
            <td class="text-right"><span
                class="ui-column-title text-left float-left">{{ 'TOTAL_PREMIUM' | translate }}</span><span
                class="float-right">{{analysis.TotalPremium | number:'.2'}} KM</span></td>
          </tr>
        </ng-template>
        <ng-template pTemplate="footer">
          <tr class="border-left-right-table border-top-2px font-size-17 display-none">
            <th colspan="5" class="text-left border-table padding-left-12px">{{'TOTAL' | translate}}</th>
            <th class="text-right border-left-right-table padding-right-12-px">{{totalPrice | number:'.2' }} KM</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td [attr.colspan]="6" class="text-center">
              <strong>{{'NO_DATA' | translate}}</strong>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </mat-card-content>
  </mat-card>
</div>
